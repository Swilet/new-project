{% extends "blog/base.html" %}

{% block title %}'{{ tag.name }}' 태그 글 목록{% endblock %}

{% block content %}
  <div class="nm-card mb-4">
    <h5 class="mb-0">
      <i class="bi bi-tag"></i>
      태그: <strong>{{ tag.name }}</strong>
    </h5>
  </div>

  {% if posts %}
    <div class="nm-card mb-4">
      <h5 class="mb-0">
        <i class="bi bi-collection"></i>
        블로그 글 ({{ posts.count }}개)
      </h5>
    </div>
    {% for post in posts %}
        <div class="nm-card mb-3 position-relative">
          <h2 class="h5 mb-1">{{ post.title }}</h2>
          <p class="small text-secondary mb-2">{{ post.created_at|date:"Y년 n월 j일" }}</p>
          <div class="text-secondary text-truncate-2">
              {{ post.content|striptags }}
          </div>
          <a href="{% url 'blog:post_detail' post.pk %}" class="stretched-link"></a>

          <div class="mt-3 d-flex flex-wrap gap-2">
            {% for cat in post.categories.all %}
              <a href="{% url 'blog:posts_by_category' cat.name %}" class="badge text-bg-light text-decoration-none position-relative" style="z-index: 1;">{{ cat.name }}</a>
            {% endfor %}
            {% for tag in post.tags.all %}
              <a href="{% url 'blog:posts_by_tag' tag.name %}" class="badge text-bg-primary text-decoration-none position-relative" style="z-index: 1;">{{ tag.name }}</a>
            {% endfor %}
          </div>
        </div>
    {% endfor %}
  {% endif %}

  {% if travels %}
    <div class="nm-card mb-4 mt-4">
      <h5 class="mb-0">
        <i class="bi bi-airplane"></i>
        여행 기록 ({{ travels.count }}개)
      </h5>
    </div>
    <div class="row">
      {% for travel in travels %}
        <div class="col-md-6 mb-4">
          <div class="nm-card h-100 position-relative">
              <h5 class="card-title">{{ travel.name }}</h5>
              <p class="card-text small text-secondary">{{ travel.description|truncatewords_html:20|safe }}</p>
              <div class="mt-auto pt-3">
                <div class="d-flex flex-wrap gap-1">
                {% for tag in travel.tags.all %}
                  <a href="{% url 'blog:posts_by_tag' tag.name %}" class="badge text-bg-primary text-decoration-none position-relative" style="z-index: 1;">{{ tag.name }}</a>
                {% endfor %}
                </div>
              </div>
              <a href="{% url 'travel:travel_detail' travel.pk %}" class="stretched-link"></a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if not posts and not travels %}
    <div class="nm-card">
        <p class="mb-0">'{{ tag.name }}' 태그에 해당하는 글이나 여행 기록이 없습니다.</p>
    </div>
  {% endif %}

{% endblock %}
